{% extends "taxiapp/base.html" %}
{% block main %}
<link rel="stylesheet" href="https://cdn.datatables.net/1.10.13/css/dataTables.bootstrap.min.css"/>

<title>Taxi App</title>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.0/css/bootstrap.min.css">
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.0/js/bootstrap.min.js"></script>

</head>

<body>
    <div class="container">
        <div class="row">
            <form class="form-inline" name="taxiList" id="taxiList" action='/taxi_list/' method='POST'>
                {% csrf_token %}
                    <div class="form-group mb-2">City:
                      
                            <select class="form-control" name="city_code" id="city_code">
                                    <option value="All">All</option>
                                    {% for city in cities %}
                                    <option value="{{city.city_code}}" {% if city.city_code == city_code %}selected="selected"{% endif %}>{{ city.city }}</option>
                                    {% endfor %}
                            </select>

                    </div>

                     <div class="form-group mb-2">Vehicle Type:
                      
                            <select class="form-control" name="vehicletype" id="vehicletype">
                                    <option value="All">All</option>
                                    {% for vehicletype in vehicletypes %}
                                    <option value="{{vehicletype}}">{{ vehicletype }}</option>
                                    {% endfor %}
                            </select>


                    </div>
                   
                    <div class="form-group mb-3">
                            Range From :
                            <input style="width:100px;" class="form-control" type="text" name="rangeFrom" id="rangeFrom" value="" />
                    </div>

                    <div class="form-group mb-3">
                            Range To :
                            <input style="width:100px;" class="form-control" type="text" name="rangeTo" id="rangeTo" value="" />
                    </div>

                    <div class="form-group mb-3">
                            Traffic Number :
                            <input style="width:100px;" class="form-control" type="text" name="taxiIds" id="taxiIds" value="" />
                    </div>

                    <div class="form-group mb-3">
                            Number Plate :
                            <input style="width:100px;" class="form-control" type="text" name="numberPlates" id="numberPlates" value="" />
                    </div> 

                    <input type="hidden" name ="page" id="page"/>
                    <button type="submit" class="btn btn-primary mb-2">Search</button>

            </form>
      </div>
    </div>
    <br>
    <br>
   
    <div class="container">
      <ul class="nav nav-tabs">
        <li class="active"><a data-toggle="tab" href="#dashboard">Dashboard</a></li>
        <li><a data-toggle="tab" href="#vehiclelist">Vehicle List</a></li>
        <li><a data-toggle="tab" href="#complaints">Complaints List</a></li>
        <li><a data-toggle="tab" href="#custrating">Customer Ratings</a></li>
        <li><a data-toggle="tab" href="#vehiclereg">Vehicle Registration</a></li>
      </ul>
    
      <div class="tab-content">
        <div id="dashboard" class="tab-pane fade in active">

                <div style="padding-bottom: 55px;">
                         <center><h3>Dashboard</h3></center>
                         <table id="taxi-list" class="table table-striped table-bordered" width="100%" cellspacing="0">
                                 <thead>
                                     <tr>
                                         <th>City </th>
                                         <th>Today </th>
                                         <th>This Week</th>
                                         <th>This Month</th>
                                         <th>This Year</th>
                                         <th>Total</th>
                                         
                                     </tr>
                                 </thead>
                                 <tbody>
                     
                                     
                                     <tr>
                                         <td>{{city_code}}</td>
                                         <td>{{dashboardDict.todayVRCount}}</td>
                                         <td>{{dashboardDict.thisWeekVRCount}}</td>
                                         <td>{{dashboardDict.thisMonthVRCount}}</td>
                                         <td>{{dashboardDict.thisYearVRCount}}</td>
                                         <td>{{dashboardDict.total}}</td>
                                         
                                     </tr>
                                     
                                 </tbody>
                         </table>
                         
                         </div>
         
        </div>
        <div id="vehiclelist" class="tab-pane fade">
                <h4 style="text-align: center; color: green;">{{msg_vehicle_list}}</h4>
                <div style="float: right;">
                    <a href="/add_vehicle" >
                        <button class="btn btn-primary btn-sm">Add Vehicle</button>
                    </a>
                    <a href="/add_driver" >
                        <button class="btn btn-primary btn-sm">Add Driver</button>
                    </a>
                </div>
                <div style="padding-bottom: 55px;">
                        <center><h3>Vehicle List</h3></center>
                        <table id="taxi-list" class="table table-striped table-bordered" width="100%" cellspacing="0">
                                <thead>
                                    <tr>
                                        
                                        <th>Traffic Number</th>
                                        <th>Vehicle Number</th>
                                        <th>City</th>
                                        <th>Name</th>
                                        <th>Phone Number</th>       
                                        <th>Average Rating</th>
                                        <th>Number of Complaints</th>
                                    </tr>
                                </thead>
                                <tfoot>
                                    <tr>
                                        <th>Traffic Number</th>
                                        <th>Vehicle Number</th>
                                        <th>City</th>
                                        <th>Name</th>
                                        <th>Phone Number</th>       
                                        <th>Average Rating</th>
                                        <th>Number of Complaints</th>
                                    </tr>
                                </tfoot>
                                <tbody>
                                    {% for row in rows %}
                                    <tr>
                                        <td><a href="{% url 'taxiapp:taxi_detail' pk=row.traffic_number %}">{{row.traffic_number}}</a></td>
                                        <td>{{row.number_plate}}</td>
                                        <td>{{row.city.city}}</td>
                                        <td>{{row.owner.owner_name}}</td>
                                        <td>{{row.owner.phone_number}}</td>
                                        <td></td>
                                        <td>{{row.num_of_complaints}}</td>
                                    </tr>
                                    {% endfor %}
                                </tbody>
                        </table>
                        
                        <ul class="pagination" style="float: right;">
                        
                            {% if rows.has_previous %}
                                <!-- <li><a href="?page={{ rows.previous_page_number }}"><i class="fa fa-chevron-left" aria-hidden="true"></i></a></li> -->
                                <li><a href="javascript:getPaginationData({{ rows.previous_page_number }})"><i class="fa fa-chevron-left" aria-hidden="true"></i></a></li>
                            {% else %}
                                <li class="disabled"><span><i class="fa fa-chevron-left" aria-hidden="true"></i></span></li>
                            {% endif %}
                            
                            {% if rows.number|add:'-4' > 1 %}
                                <!-- <li><a href="?page={{ rows.number|add:'-5' }}">&hellip;</a></li> -->
                                <li><a href="javascript:getPaginationData({{ rows.number|add:'-5' }})">&hellip;</a></li>
                            {% endif %}
                            
                            {% for i in rows.paginator.page_range %}
                                {% if rows.number == i %}
                                    <li class="active"><span>{{ i }} <span class="sr-only">(current)</span></span></li>
                                {% elif i > rows.number|add:'-5' and i < rows.number|add:'5' %}
                                    <li><a href="javascript:getPaginationData({{ i }})">{{ i }}</a></li>
                                {% endif %}
                            {% endfor %}
                            
                            {% if rows.paginator.num_pages > rows.number|add:'4' %}
                                <li><a href="javascript:getPaginationData({{ rows.number|add:'5' }})">&hellip;</a></li>
                            {% endif %}
                            
                            {% if rows.has_next %}
                                <li><a href="javascript:getPaginationData({{ rows.next_page_number }})"><i class="fa fa-chevron-right" aria-hidden="true"></i></a></li>
                            {% else %}
                                <li class="disabled"><span><i class="fa fa-chevron-right" aria-hidden="true"></i></span></li>
                            {% endif %}
                            
                            </ul>
                        </div>
                        
                        <script src="https://cdn.datatables.net/1.10.13/js/jquery.dataTables.min.js"/></script>
                        <script src="https://cdn.datatables.net/1.10.13/js/dataTables.bootstrap.min.js"/></script>
                        <script>
                        // $(document).ready(function() {
                        //     $('#taxi-list').DataTable();
                        // } );
                        function getPaginationData(page) {
                            document.getElementById("page").value = page;
                            document.getElementById("taxiList").submit();
                        }
                        
                        </script>
          
        </div>
        <div id="complaints" class="tab-pane fade">

                <div>
                        <center><h3>Complaints</h3></center>
                        <table id="example" class="table table-striped table-bordered" width="100%" cellspacing="0">
                                <thead>
                                    <tr>
                                        <th>Complaint Id</th>
                                        <th>Traffic Number</th>
                                        <th>Number Plate</th>
                                        <th>City</th>
                                        <th>Driver Name</th>
                                        <th>Complaint Reason</th>
                                        <th>Assigned To</th>
                                        <th>Customer Phone number</th>
                                        <th>Status</th>
                                    </tr>
                                </thead>
                                <tfoot>
                                    <tr>
                                        <th>Complaint Id</th>
                                        <th>Traffic Number</th>
                                        <th>Number Plate</th>
                                        <th>City</th>
                                        <th>Driver Name</th>
                                        <th>Complaint Reason</th>
                                        <th>Assigned To</th>
                                        <th>Customer Phone number</th>
                                        <th>Status</th>
                                    </tr>
                                </tfoot>
                                <tbody>
                                    {% for row in rows_c %}
                                    <tr>
                                        <td><a href="{% url 'taxiapp:complaint_view' pk=row.complaint_number %}">{{row.complaint_number}}</a></td>
                                        <td>{{row.vehicle.traffic_number}}</td>
                                        <td>{{row.vehicle.number_plate}}</td>
                                        <td>{{row.city.city}}</td>
                                        <td>{{row.vehicle.owner.owner_name}}</td>
                                        <td>{{row.reason.reason}}</td>
                                        {% if row.assigned_to.user_number %}
                                        <td>Id: {{row.assigned_to.user_number}} | SMS: {{row.assigned_to.sms_number}}</td>
                                        {% else %}
                                        <td>Id: Admin | SMS: {{row.assigned_to.sms_number}}</td>
                                        {% endif %}
                                        <td>{{row.phone_number}}</td>
                                        {% if row.resolved == False %}
                                        <td><a href="{% url 'taxiapp:complaint_view' pk=row.complaint_number %}"><button>Resolve</button></a></td>
                                        {% else %}
                                        <td>{{'Resolved'}}</td>
                                        {% endif %}                                       
                                    </tr>
                                    {% endfor %}
                                </tbody>
                        </table>
                        </div>
                        <script src="https://cdn.datatables.net/1.10.13/js/jquery.dataTables.min.js"/></script>
                        <script src="https://cdn.datatables.net/1.10.13/js/dataTables.bootstrap.min.js"/></script>
                        <script>
                        $(document).ready(function() {
                            $('#example').DataTable();
                        } );
                        </script>
          
        </div>
        <div id="custrating" class="tab-pane fade">

                <div>
                        <center><h3>Customer Ratings</h3></center>
                        <table id="customer_ratings" class="table table-striped table-bordered" width="100%" cellspacing="0">
                                <thead>
                                    <tr>
                                        <th>Traffic Number</th>
                                        <th>Number Plate</th>
                                        <th>City</th>
                                        <th>Driver Name</th>
                                        <th>Rating Type</th>
                                        <th>Rating Reason</th>
                                        <th>Customer Phone Number</th>
                                    </tr>
                                </thead>
                                <tfoot>
                                    <tr>
                                        <th>Traffic Number</th>
                                        <th>Number Plate</th>
                                        <th>City</th>
                                        <th>Driver Name</th>
                                        <th>Rating Type</th>
                                        <th>Rating Reason</th>
                                        <th>Customer Phone Number</th>
                                    </tr>
                                </tfoot>
                                <tbody>
                                    {% for rating in ratings %}
                                    <tr>
                                        <td>{{rating.vehicle.traffic_number}}</td>
                                        <td>{{rating.vehicle.number_plate}}</td>
                                        <td>{{rating.vehicle.city.city}}</td>
                                        <td>{{rating.driver.driver_name}}</td>
                                        <td>{{rating.rating_type.rating_type}}</td>
                                        <td>{{rating.reason}}</td>
                                        <td>{{rating.phone_number}}</td>
                                        
                                    </tr>
                                    {% endfor %}
                                </tbody>
                        </table>
                        </div>
                        <script src="https://cdn.datatables.net/1.10.13/js/jquery.dataTables.min.js"/></script>
                        <script src="https://cdn.datatables.net/1.10.13/js/dataTables.bootstrap.min.js"/></script>
                        <script>
                        $(document).ready(function() {
                            $('#customer_ratings').DataTable();
                        } );
                        </script>
          
        </div>
        
        <div id="vehiclereg" class="tab-pane fade">

                <div>
                        <center><h3>Vehicle Registration</h3></center>
                        <table id="vehicle_reg_list" class="table table-striped table-bordered" width="100%" cellspacing="0">
                                <thead>
                                    <tr>
                                        <th>Traffic Number</th>
                                        <th>Number Plate</th>
                                        <th>City</th>
                                        <th>Auto Stand</th>
                                        <th>Union</th>
                                    </tr>
                                </thead>
                                <tfoot>
                                    <tr>
                                        <th>Traffic Number</th>
                                        <th>Number Plate</th>
                                        <th>City</th>
                                        <th>Auto Stand</th>
                                        <th>Union</th>
                                    </tr>
                                </tfoot>
                                <tbody>
                                    {% for row in vehicleregistrations %}
                                    <tr>
                                        <td>{{row.traffic_number}}</td>
                                        <td>{{row.number_plate}}</td>
                                        <td>{{row.city.city}}</td>
                                        <td>{{row.autostand}}</td>
                                        <td>{{row.union}}</td>
                                        <!-- <td>{{row.is_owner_driver}}</td>
                                        <td><a href="{% url 'taxiapp:taxi_detail' pk=row.traffic_number %}">{{'More Details'}}</a></td> -->
                                    </tr>
                                    {% endfor %} 
                                    
                                </tbody>
                        </table>

                

      </div>
      <script src="https://cdn.datatables.net/1.10.13/js/jquery.dataTables.min.js"/></script>
                        <script src="https://cdn.datatables.net/1.10.13/js/dataTables.bootstrap.min.js"/></script>
                        <script>
                        $(document).ready(function() {
                            $('#vehicle_reg_list').DataTable();
                        } );
                        </script>
    </div>
    </div>
    </div>
    </body>





{% endblock %}
